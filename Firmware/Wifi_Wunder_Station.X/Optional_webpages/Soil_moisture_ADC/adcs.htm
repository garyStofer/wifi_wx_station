<!DOCTYPE html>
<html>
<head>
<link href="styles.css" rel="stylesheet" type="text/css" >
<script src="ajax.js" type="text/javascript"></script>
<script src="status.js" type="text/javascript"></script>
<script type="text/javascript">

setTimeout("newAJAXCommand('status_adc.xml', updtADCStatRaw, true)",100);
function updtADCStatRaw(xmlData)
{
var Vx;  // Voltage from VH400
var Vr; // voltage Result

	if ( timed_out(	xmlData) )
		return;

	for(i=10;i<=14;i++)
	{	
		Vx = getXMLValue(xmlData, 'adc'+i) * (3.3/1023);
				
		if (i==13)	// The soil temp from LM34 -- 10mv == 1 deg F
		{
			Vr = Vx / 0.01;
		}
		else if (i==14)	// VBAT
		{
			Vx = getXMLValue(xmlData, 'adc'+i);
			Vr = Vx * (15.95/1023); //15V scale 
		}
		else
		{
			if ( Vx < 1.1)
				Vr = Vx*10.0 - 1;
			else if ( Vx < 1.3)
				Vr = Vx*25.0 - 17.5;
			else if ( Vx < 1.82 )
				Vr = Vx*48.08 - 47.5;
			else
				Vr= Vx*26.32 - 7.89;
		}	
        document.getElementById('adc'+i).innerHTML = Vr.toFixed(2);
    }
	document.getElementById('adc5').innerHTML = getXMLValue(xmlData, 'adc5');
	
	for (i=0;i<3;i++)
	{
		var j = i+10;
		Vx = getXMLValue(xmlData, 'adc'+j) * (3.3/1023);
		document.getElementById('adc'+i).innerHTML = Vx.toFixed(2);
	}

}
</script>
</head>

<body class="inframe" >
 	<h3>Analog Inputs:</h3>
	<div id="err" style="display:none">Error: Connection was lost.<br></div>
	<div id="ok_">

	<h4>Soil Probes</h4>
	 
	SM 1: <span id="adc0">?</span> Volt, <span id="adc10">?</span>% VWC<br>
	SM 2: <span id="adc1">?</span> Volt, <span id="adc11">?</span>% VWC<br>
	SM 3: <span id="adc2">?</span> Volt, <span id="adc12">?</span>% VWC<br>
	Temp: <span id="adc13">?</span> deg F<br>
 
	<h4>Power</h4>
	VBAT: <span id="adc14">?</span> V<br>
	Sys5V: <span id="adc5">?</span> V<br>  

	
	</div>
</body>
</html>
